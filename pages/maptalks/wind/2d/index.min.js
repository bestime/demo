/**!header
 * 风场动画 AnimateGfsWind.iife.min.js
 * 参考 https://www.windy.com/
 * @update 2023-02-21 10:30:37
 */
var AnimateGfsWind=function(){"use strict";function n(t,a,n){a in t?Object.defineProperty(t,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[a]=n}var a=Object.prototype.toString;function u(t){return"Array"===a.call(t).slice(8,-1)}function c(t){return t/180*Math.PI}function l(t,a,n,r,i,e){var o=1-t,h=1-a,s=o*h,h=t*h,o=o*a,t=t*a,a=n[0]*s+r[0]*h+i[0]*o+e[0]*t,n=n[1]*s+r[1]*h+i[1]*o+e[1]*t;return[a,n,Math.sqrt(a*a+n*n)]}function g(t){return null!==t&&t!==undefined}function f(l){for(var f=l.header,d=[],t=0,a=360<=Math.floor(f.nx*f.dx),n=0;n<f.ny;n++){for(var r=[],i=0;i<f.nx;i++)r[i]=l.data(t),t++;a&&r.push(r[0]),d[n]=r}return{data:d,interpolate:function(t,a){var n,r=d,i=l,e=(s=f).lo1,o=s.dx,h=s.la1,s=s.dy,t=function(t,a){return t-a*Math.floor(t/a)}(t-e,360)/o,e=(h-a)/s,h=(o=Math.floor(t))+1,s=(a=Math.floor(e))+1;if(n=r[a]){var u=n[o],c=n[h];if(g(u)&&g(c)&&(n=r[s])){s=n[o],r=n[h];if(g(s)&&g(r))return i.interpolate(t-o,e-a,u,c,s,r)}}return null}}}document.getElementsByTagName("head")[0];var r=[NaN,NaN,null];function d(n,s,u){function c(t,a){t=n[Math.round(t)];return t&&t[Math.round(a)]||r}return c.release=function(){n=[]},c.randomize=function(t){for(var a,n,r=0;null===c(a=Math.round(Math.floor(Math.random()*s.width)+s.x),n=Math.round(Math.floor(Math.random()*s.height)+s.y))[2]&&r++<30;);var i,e,o,h=c(t.x=a,t.y=n)[2];return t.color="function"==typeof u?u(h):(e=h,o=(i=u).length,e=Math.max(0,Math.min(o-1,Math.round(+h/10*(o-1)))),i[e]),t},c}function p(t){return t/(Math.PI/180)}function o(t){return Math.log(Math.tan(t/2+Math.PI/4))}var w=.005*(Math.pow(window.devicePixelRatio,1/3)||1);function M(t,a,n){for(var r,i,e,o,h=(n.south-n.north)*(n.west-n.east),s=w*Math.pow(h,.4),u=[],c=0;c<a.width;c++){for(var l=[],f=a.y;f<=a.yMax;f++){v=c,g=f,M=e=void 0,o=void 0,e=(d=n).east-d.west,M=d.width/p(e)*360/(2*Math.PI),o=M/2*Math.log((1+Math.sin(d.south))/(1-Math.sin(d.south))),o=d.height+o,o=180/Math.PI*(2*Math.atan(Math.exp((o-g)/M))-Math.PI/2);var d,g=[p(d.west)+v/d.width*p(e),o],M=g[0],v=g[1];isFinite(M)&&(d=t.interpolate(M,v))&&(e=M,o=c,g=f,M=s,i=void 0,i=(r=d)[0]*M,M=r[1]*M,e=function(t,a,n,r,i){var e=2*Math.PI,o=Math.pow(10,-5.2),h=t<0?o:-o,o=a<0?o:-o,s=x(a,t+h,i),t=x(a+o,t,i),i=Math.cos(a/360*e);return[(s[0]-n)/h/i,(s[1]-r)/h/i,(t[0]-n)/o,(t[1]-r)/o]}(e,v,o,g,n),r[0]=e[0]*i+e[2]*M,r[1]=e[1]*i+e[3]*M,d=r,l[f]=d)}u[c]=l}return u}function x(t,a,n){var r=o(n.south),i=o(n.north),e=n.width/(n.east-n.west),r=n.height/(i-r),t=o(c(t));return[(c(a)-n.west)*e,(i-t)*r]}function v(a,n,i,t,r){for(var e,o=!1,h=!1,s=a._ctx,u=a._config,c=u.maxAge??50,l=u.particleCount,f=(null==l&&(t=(t.south-t.north)*(t.west-t.east),t=Math.pow(t,.2),l=Math.round(n.width*n.height*(1/300)*t)),{}),d=[],g=0;g<l;g++){var M=i.randomize({age:Math.floor(Math.random()*c)+0});d.push(M)}var v=s;v.lineWidth=u.lineWidth,v.globalAlpha=.6;var p,w=(new Date).getTime();return function x(){if(e&&cancelAnimationFrame(e),!o&&!h&&(p=(new Date).getTime(),r<p-w)){for(var t in w=p,f={},d.forEach(function(t){t.age>c&&(i.randomize(t),t.age=0);var a=t.x,n=t.y,r=i(a,n);null===r[2]?t.age=c:(a=a+r[0],n=n+r[1],null!==i(a,n)[2]?(t.xt=a,t.yt=n,f[t.color]=f[t.color]||[],f[t.color].push(t)):(t.x=a,t.y=n)),t.age+=1}),v.globalCompositeOperation="destination-in",v.fillRect(n.x,n.y,n.width,n.height),v.globalCompositeOperation="lighter",v.globalAlpha=.92,f)v.beginPath(),v.strokeStyle=t,f[t].forEach(function(t){v.moveTo(t.x,t.y),v.lineTo(t.xt,t.yt),t.x=t.xt,t.y=t.yt}),v.stroke();a._config?.reDraw?.()}h||(e=requestAnimationFrame(x))}(),{play:function(){o=!1},pause:function(){o=!0},dispose:function(){h=o=!0}}}return function(){function t(t,a){n(this,"_canvas",void 0),n(this,"_active",!0),n(this,"_ctx",void 0),n(this,"_gfsData",[]),n(this,"_controller",void 0),n(this,"_config",{colors:["rgb(36,104, 180)","rgb(60,157, 194)","rgb(128,205,193 )","rgb(151,218,168 )","rgb(198,231,181)","rgb(238,247,217)","rgb(255,238,159)","rgb(252,217,125)","rgb(255,182,100)","rgb(252,150,75)","rgb(250,112,52)","rgb(245,64,32)","rgb(237,45,28)","rgb(220,24,32)","rgb(180,0,35)"],lineWidth:1,speed:30}),this._canvas=t,this._ctx=t.getContext("2d"),Object.assign(this._config,a)}var a=t.prototype;return a.setGfsData=function(t){this._gfsData=t},a.getGfsData=function(){return this._gfsData},a.start=function(t,a,n,r){this._canvas.width=a,this._canvas.height=n,this._canvas.style.width=a+"px",this._canvas.style.height=n+"px";var r={south:c(r[0][1]),north:c(r[1][1]),east:c(r[1][0]),west:c(r[0][0]),width:a,height:n},i=this.getGfsData();if(!(u(i)&&2===i.length))return this.dispose(),this;if(!u(i)&&0===i.length)throw"no wind data";a=a,n=n,s=(t=t)[0],t=t[1],e=Math.round(s[0]),s=Math.max(Math.floor(s[1]),0),Math.min(Math.ceil(t[0]),a-1);var e={x:e,y:s,xMax:a,yMax:Math.min(Math.ceil(t[1]),n-1),width:a,height:n};o=i[0],h=i[1];var o,h,s=d(M(f({header:o.header,data:function(t){return[o.data[t],h.data[t]]},interpolate:l}),e,r),e,this._config.colors);return this.clear(),this._controller?.dispose(),this._controller=v(this,e,s,r,this._config.speed),this},a.clear=function(){this.dispose(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height)},a.pause=function(){this._controller?.pause()},a.dispose=function(){this._controller?.dispose()},t}()}();
