/**!header
 * 风场动画 AnimateGfsWind.iife.min.js
 * 参考 https://www.windy.com/
 * @update 2023-01-03 11:49:46
 */
var AnimateGfsWind=function(){"use strict";function n(t,a,n){a in t?Object.defineProperty(t,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[a]=n}var a=Object.prototype.toString;function c(t){return"Array"===a.call(t).slice(8,-1)}function u(t){return t/180*Math.PI}function l(t,a,n,r,o,i){var e=1-t,h=1-a,s=e*h,h=t*h,e=e*a,t=t*a,a=n[0]*s+r[0]*h+o[0]*e+i[0]*t,n=n[1]*s+r[1]*h+o[1]*e+i[1]*t;return[a,n,Math.sqrt(a*a+n*n)]}function g(t){return null!==t&&t!==undefined}function f(l){for(var f=l.header,d=[],t=0,a=360<=Math.floor(f.nx*f.dx),n=0;n<f.ny;n++){for(var r=[],o=0;o<f.nx;o++)r[o]=l.data(t),t++;a&&r.push(r[0]),d[n]=r}return{data:d,interpolate:function(t,a){var n,r=d,o=l,i=(s=f).lo1,e=s.dx,h=s.la1,s=s.dy,t=function(t,a){return t-a*Math.floor(t/a)}(t-i,360)/e,i=(h-a)/s,h=(e=Math.floor(t))+1,s=(a=Math.floor(i))+1;if(n=r[a]){var c=n[e],u=n[h];if(g(c)&&g(u)&&(n=r[s])){s=n[e],r=n[h];if(g(s)&&g(r))return o.interpolate(t-e,i-a,c,u,s,r)}}return null}}}document.getElementsByTagName("head")[0];var r=[NaN,NaN,null];function d(n,s,c){function u(t,a){t=n[Math.round(t)];return t&&t[Math.round(a)]||r}return u.release=function(){n=[]},u.randomize=function(t){for(var a,n,r=0;null===u(a=Math.round(Math.floor(Math.random()*s.width)+s.x),n=Math.round(Math.floor(Math.random()*s.height)+s.y))[2]&&r++<30;);var o,i,e,h=u(t.x=a,t.y=n)[2];return t.color="function"==typeof c?c(h):(i=h,e=(o=c).length,i=Math.max(0,Math.min(e-1,Math.round(+h/10*(e-1)))),o[i]),t},u}function p(t){return t/(Math.PI/180)}function e(t){return Math.log(Math.tan(t/2+Math.PI/4))}var w=.005*(Math.pow(window.devicePixelRatio,1/3)||1);function M(t,a,n){for(var r,o,i,e,h=(n.south-n.north)*(n.west-n.east),s=w*Math.pow(h,.4),c=[],u=0;u<a.width;u++){for(var l=[],f=a.y;f<=a.yMax;f++){v=u,g=f,M=i=void 0,e=void 0,i=(d=n).east-d.west,M=d.width/p(i)*360/(2*Math.PI),e=M/2*Math.log((1+Math.sin(d.south))/(1-Math.sin(d.south))),e=d.height+e,e=180/Math.PI*(2*Math.atan(Math.exp((e-g)/M))-Math.PI/2);var d,g=[p(d.west)+v/d.width*p(i),e],M=g[0],v=g[1];isFinite(M)&&(d=t.interpolate(M,v))&&(i=M,e=u,g=f,M=s,o=void 0,o=(r=d)[0]*M,M=r[1]*M,i=function(t,a,n,r,o){var i=2*Math.PI,e=Math.pow(10,-5.2),h=t<0?e:-e,e=a<0?e:-e,s=x(a,t+h,o),t=x(a+e,t,o),o=Math.cos(a/360*i);return[(s[0]-n)/h/o,(s[1]-r)/h/o,(t[0]-n)/e,(t[1]-r)/e]}(i,v,e,g,n),r[0]=i[0]*o+i[2]*M,r[1]=i[1]*o+i[3]*M,d=r,l[f]=d)}c[u]=l}return c}function x(t,a,n){var r=e(n.south),o=e(n.north),i=n.width/(n.east-n.west),r=n.height/(o-r),t=e(u(t));return[(u(a)-n.west)*i,(o-t)*r]}function v(a,n,o,t,r){for(var i,e=!1,h=!1,s=a._ctx,c=a._config,t=(t.south-t.north)*(t.west-t.east),t=Math.pow(t,.2),u=Math.round(n.width*n.height*(1/300)*t),l={},f=[],d=0;d<u;d++){var g=o.randomize({age:Math.floor(50*Math.random())+0});f.push(g)}var M=s;M.lineWidth=c.lineWidth,M.globalAlpha=.6;var v,p=(new Date).getTime();return function w(){if(i&&cancelAnimationFrame(i),!e&&!h&&(v=(new Date).getTime(),r<v-p)){for(var t in p=v,l={},f.forEach(function(t){50<t.age&&(o.randomize(t),t.age=0);var a=t.x,n=t.y,r=o(a,n);null===r[2]?t.age=50:(a=a+r[0],n=n+r[1],null!==o(a,n)[2]?(t.xt=a,t.yt=n,l[t.color]=l[t.color]||[],l[t.color].push(t)):(t.x=a,t.y=n)),t.age+=1}),M.globalCompositeOperation="destination-in",M.fillRect(n.x,n.y,n.width,n.height),M.globalCompositeOperation="lighter",M.globalAlpha=.92,l)M.beginPath(),M.strokeStyle=t,l[t].forEach(function(t){M.moveTo(t.x,t.y),M.lineTo(t.xt,t.yt),t.x=t.xt,t.y=t.yt}),M.stroke();a._config?.reDraw?.()}h||(i=requestAnimationFrame(w))}(),{play:function(){e=!1},pause:function(){e=!0},dispose:function(){h=!0}}}return function(){function t(t,a){n(this,"_canvas",void 0),n(this,"_active",!0),n(this,"_ctx",void 0),n(this,"_gfsData",[]),n(this,"_controller",void 0),n(this,"_config",{colors:["rgb(36,104, 180)","rgb(60,157, 194)","rgb(128,205,193 )","rgb(151,218,168 )","rgb(198,231,181)","rgb(238,247,217)","rgb(255,238,159)","rgb(252,217,125)","rgb(255,182,100)","rgb(252,150,75)","rgb(250,112,52)","rgb(245,64,32)","rgb(237,45,28)","rgb(220,24,32)","rgb(180,0,35)"],lineWidth:2,speed:30}),this._canvas=t,this._ctx=t.getContext("2d"),Object.assign(this._config,a)}var a=t.prototype;return a.setGfsData=function(t){this._gfsData=t},a.getGfsData=function(){return this._gfsData},a.start=function(t,a,n,r){this._canvas.width=a,this._canvas.height=n,this._canvas.style.width=a+"px",this._canvas.style.height=n+"px";var r={south:u(r[0][1]),north:u(r[1][1]),east:u(r[1][0]),west:u(r[0][0]),width:a,height:n},o=this.getGfsData();if(!c(o)&&0===o.length)throw"no wind data";a=a,n=n,s=(t=t)[0],t=t[1],i=Math.round(s[0]),s=Math.max(Math.floor(s[1]),0),Math.min(Math.ceil(t[0]),a-1);var i={x:i,y:s,xMax:a,yMax:Math.min(Math.ceil(t[1]),n-1),width:a,height:n};e=o[0],h=o[1];var e,h,s=d(M(f({header:e.header,data:function(t){return[e.data[t],h.data[t]]},interpolate:l}),i,r),i,this._config.colors);this.clear(),this._controller?.dispose(),this._controller=v(this,i,s,r,this._config.speed)},a.clear=function(){this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height)},a.pause=function(){this._controller?.dispose()},a.dispose=function(){this.clear(),this._controller?.dispose()},t}()}();
